<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>BOI MUSIC</title>
<script src="https://www.youtube.com/iframe_api"></script>
<style>
:root{
  --bg:#0b0f12; --panel:#0f1720; --muted:#9aa4ad; --accent:#1db954;
  --card:#0d1518; --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
html,body{
  height:100%;
  margin:0;
  font-family:Inter, "Segoe UI", Roboto, Arial;
  background:var(--bg);
  color:#e6eef3;
}

.app{
  display:grid;
  grid-template-columns:260px 1fr;
  gap:18px;
  height:100vh;
  padding:18px;
  transition:all .28s ease;
}

.sidebar{
  background:var(--panel);
  border-radius:12px;
  padding:14px;
  display:flex;
  flex-direction:column;
  gap:12px;
  height:calc(100vh - 36px);
  overflow:auto;
}

.logo{
  font-weight:700;
  font-size:18px;
  color:var(--accent);
  letter-spacing:0.6px;
}

.side-section{margin-top:8px}

.playlist-item{
  display:flex;
  gap:10px;
  align-items:center;
  padding:8px;
  border-radius:8px;
  cursor:pointer;
}

.playlist-item:hover{background:var(--glass)}

.btn{
  background:transparent;
  border:1px solid rgba(255,255,255,0.04);
  padding:8px 10px;
  border-radius:8px;
  color:var(--muted);
  cursor:pointer;
}

.btn-primary{
  background:var(--accent);
  color:#02140b;
  border:none;
  font-weight:600;
}

.main{
  display:flex;
  flex-direction:column;
  height:100vh; /* full viewport height */
}

.topbar {
  flex: 0 0 60px;
  min-height: 60px;
  max-height: 60px;
}

.search{
  display:flex;
  gap:8px;
  align-items:center;
  width:100%;
  position:relative;
}

.search input{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:none;
  background:#07121a;
  color:#eaf6ee;
}

.content-wrapper{
  display:flex;
  flex:1 1 auto; /* takes all space above player */
  gap:12px;
  overflow:hidden; /* prevents content overflow */
  align-items:stretch;
}

.left-main{
  display:flex;
  flex-direction:column;
  flex:1 1 0;
  min-width:0;
  overflow-y:auto; /* scrolls when content is too big */
}

.card{
  background:var(--card);
  padding:12px;
  border-radius:10px;
  overflow:auto;
}

.results{
  max-height:200px;
  overflow-y:auto;
}

.track-row{
  display:flex;
  gap:12px;
  align-items:center;
  padding:10px;
  border-radius:10px;
  cursor:pointer;
}

.track-row:hover{background:var(--glass)}

.track-thumb{
  width:72px;
  height:72px;
  border-radius:8px;
  flex:0 0 72px;
  object-fit:cover;
}

.track-meta{flex:1}

.track-title{font-weight:600}

.track-sub{
  color:var(--muted);
  font-size:13px;
  margin-top:4px;
}

.right-col{
  width:360px;
  display:flex;
  flex-direction:column;
  gap:10px;
  overflow-y:auto; /* scroll if content grows */
}

.queue-list{
  flex:1 1 auto;
  overflow-y:auto;
  min-height:120px;
}

.player-bar{
  flex:0 0 84px; /* fixed height */
  border-radius:12px;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  display:flex;
  align-items:center;
  gap:12px;
  padding:12px;
  width:100%;
}

.player-left{
  display:flex;
  gap:12px;
  align-items:center;
  width:30%;
}

.player-thumb{
  width:64px;
  height:64px;
  border-radius:8px;
  object-fit:cover;
  background:#081018;
}

.player-controls{
  display:flex;
  gap:8px;
  align-items:center;
  justify-content:center;
  width:40%;
}

.control-btn{
  background:transparent;
  border:none;
  color:#eaf6ee;
  font-size:18px;
  cursor:pointer;
  padding:8px;
  border-radius:8px;
}

.control-btn:hover{background:var(--glass)}

.small{font-size:13px}
.muted{color:var(--muted)}

.playlist-drawer{
  position: fixed;
  top: 0;
  right: 0;
  height: 100vh;
  width: 0;
  background: linear-gradient(180deg,#0e1b1f,#071217);
  border-radius: 0 12px 12px 0;
  overflow: hidden;
  box-shadow: 0 12px 40px rgba(0,0,0,0.6);
  transition: width .28s ease;
  display: flex;
  flex-direction: column;
  z-index: 101;
}

.playlist-drawer.open{width:400px}

.drawer-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px;
  border-bottom:1px solid rgba(255,255,255,0.03);
}

.drawer-body{
  padding:12px;
  overflow:auto;
  flex:1;
}

.drawer-footer{
  padding:12px;
  border-top:1px solid rgba(255,255,255,0.03);
  display:flex;
  gap:8px;
  align-items:center;
}

.playlist-song{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:8px;
  border-radius:8px;
  margin-bottom:6px;
  background:transparent;
}

.song-meta{flex:1;margin-left:8px}
.song-actions{display:flex;gap:6px;align-items:center}
.highlight{background:rgba(29,185,84,0.12)}
.close-btn{
  background:transparent;
  border:none;
  color:var(--muted);
  font-size:18px;
  cursor:pointer;
  padding:6px;
}

.fade-overlay{
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: transparent;
  pointer-events: none;
  transition: background .28s ease;
  z-index: 100;
}

.fade-overlay.visible{
  background: rgba(0,0,0,0.36);
  pointer-events: auto;
}

.playlist-controls{
  display:flex;
  gap:8px;
  align-items:center;
  margin-left:8px;
}

@media(max-width:1000px){
  .app{grid-template-columns:1fr}
  .sidebar{position:relative;z-index:3}
  .playlist-drawer.open{
    width:100vw;
    right:0;
    left:0;
    border-radius:0;
    top:0;
    height:100vh;
  }
}

</style>
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="logo">BOI MUSIC</div>

    <div class="side-section card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Playlists</div>
        <div>
          <button class="btn" id="newPlaylistBtn">+ New</button>
          <button class="btn" id="deletePlaylistBtn">Delete</button>
        </div>
      </div>
      <div id="playlistsList" style="margin-top:8px"></div>
    </div>

    <div class="side-section card">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <div style="font-weight:700">Now Playing Queue</div>
      </div>
      <div style="margin-top:8px">
        <button class="btn" id="clearQueueBtn">Clear</button>
        <button class="btn" id="shuffleBtn">Shuffle</button>
      </div>
    </div>

    <div style="margin-top:auto;font-size:13px;color:var(--muted)">BOI MUSIC</div>
  </aside>

  <main class="main">
    <div class="topbar card">
      <div class="search">
        <input id="searchInput" placeholder="Search YouTube">
        <button class="btn btn-primary" id="searchBtn">Search</button>
      </div>
    </div>

    <div class="content">
      <div class="left-main">
        <section class="card" style="margin-bottom:12px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div><div style="font-weight:800;font-size:18px">Search Results</div></div>
          </div>
          <div id="results" class="results" style="margin-top:10px"></div>
        </section>

        <section class="card" style="flex:1;display:flex;flex-direction:column;gap:8px">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:700">Now Playing Queue</div>
            <div class="muted small">Queue length: <span id="queueCount">0</span></div>
          </div>
          <div id="queueList" class="queue-list" style="margin-top:6px"></div>
        </section>
      </div>

      <!-- right column reserved but drawer will slide in from right and resize left-main -->
      <div class="right-col" style="min-width:0"></div>
    </div>

    <div class="player-bar">
      <div class="player-left">
        <img id="playerThumb" class="player-thumb" src="" alt="">
        <div>
          <div id="playerTitle" style="font-weight:700">Not playing</div>
          <div id="playerArtist" class="muted small">‚Äî</div>
          <div style="margin-top:6px">
            <button class="btn" id="addToPlaylistBtn">Add to Playlist</button>
          </div>
        </div>
      </div>

      <div class="player-controls">
        <button class="control-btn" id="prevBtn">‚èÆ</button>
        <button class="control-btn" id="playPauseBtn">‚ñ∂Ô∏è</button>
        <button class="control-btn" id="nextBtn">‚è≠</button>
        <button class="control-btn" id="repeatBtn">üîÅ</button>
      </div>

      <div style="width:25%;text-align:right;padding-right:8px">
        <!-- queue length already shown inside queue card too -->
      </div>
    </div>
  </main>
</div>

<!-- drawer (half width when open) -->
<div id="playlistDrawer" class="playlist-drawer" aria-hidden="true">
  <div class="drawer-header">
    <div style="font-weight:800;color:var(--accent)">Playlist</div>
    <div>
      <button class="btn" id="playPlaylistBtn">Play Playlist</button>
      <button class="btn" id="togglePlaylistRepeatBtn">Repeat: <span id="playlistRepeatState">Off</span></button>
      <button class="close-btn" id="closeDrawerBtn" title="Close">‚úï</button>
    </div>
  </div>
  <div class="drawer-body">
    <div style="margin-bottom:8px">
      <div class="small muted">Selected playlist:</div>
      <div id="selectedPlaylistName" style="font-weight:700;margin-top:6px">None</div>
    </div>

    <div style="display:flex;gap:8px;align-items:center;margin-bottom:10px">
      <select id="playlistAddSelect" style="flex:1;padding:8px;border-radius:8px;background:#091216;border:1px solid rgba(255,255,255,0.03);color:#eaf6ee"></select>
      <button class="btn" id="addCurrentToSelectedBtn">Add current</button>
      <button class="btn" id="createPlaylistFromDrawerBtn">New</button>
    </div>

    <div id="playlistSongs"></div>
  </div>

  <div class="drawer-footer">
    <div style="flex:1" class="muted small">Tip: delete a playlist via the left "Delete" button (requires typing exact name)</div>
    <div>
      <button class="btn" id="closeDrawerBtnFooter">Close</button>
    </div>
  </div>
</div>

<div id="fadeOverlay" class="fade-overlay"></div>

<script>
/* ---------- State ---------- */
let YTplayer;
let queue = [], currentIndex = -1, isPlaying = false;
let repeatMode = 0; // 0=no repeat,1=repeat all,2=repeat one
const repeatIcons = ["üîÅ","üîÇ","‚èπ"];
// playlists: { name: [ {videoId,title,channel,thumb}, ... ] }
let playlists = JSON.parse(localStorage.getItem('BOIMUSIC_PLAYLISTS') || '{}');
let selectedPlaylist = null;
let playlistRepeat = false;

/* ---------- IFrame API ---------- */
function onYouTubeIframeAPIReady(){
  YTplayer = new YT.Player('yt-player', {
    events: { onReady: ()=>{}, onStateChange: (e)=> { if(e.data === YT.PlayerState.ENDED) nextTrack(); } },
    playerVars: { rel:0, modestbranding:1 }
  });
}

/* ---------- Search ---------- */
async function searchSongs(q){
  const res = await fetch(`https://boi6741purpleturtle.hexorod0.workers.dev/?q=${encodeURIComponent(q)}`);
  const data = await res.json();
  const ids = data.items || [];
  const videos = await Promise.all(ids.map(async id=>{
    try{
      const r = await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${id}&format=json`);
      const info = await r.json();
      return { videoId:id, title:info.title, channel:info.author_name, thumb:info.thumbnail_url };
    }catch(e){
      return { videoId:id, title:"Unknown", channel:"", thumb:"" };
    }
  }));
  return videos;
}

document.getElementById('searchBtn').addEventListener('click', async ()=>{
  const q = document.getElementById('searchInput').value.trim(); if(!q) return;
  const results = await searchSongs(q);
  const c = document.getElementById('results'); c.innerHTML = '';
  results.forEach(item=>{
    const row = document.createElement('div'); row.className='track-row';
    row.innerHTML = `<img class="track-thumb" src="${item.thumb}">
                     <div class="track-meta"><div class="track-title">${item.title}</div><div class="track-sub">${item.channel}</div></div>`;
    row.addEventListener('click', ()=> addToQueue(item));
    c.appendChild(row);
  });
});

/* ---------- Queue ---------- */
function addToQueue(item){
  queue.push(item);
  updateQueueUI();
  saveQueueToLocal();
  if(currentIndex === -1) playIndex(0);
}
function updateQueueUI(){
  const container = document.getElementById('queueList'); container.innerHTML='';
  queue.forEach((item,i)=>{
    const row = document.createElement('div'); row.className='track-row';
    if(i===currentIndex) row.classList.add('highlight');
    row.innerHTML = `<div style="flex:0 0 36px;text-align:center">${i+1}</div><div class="track-meta">${item.title}</div>`;
    row.addEventListener('click', ()=> playIndex(i));
    container.appendChild(row);
  });
  document.getElementById('queueCount').textContent = queue.length;
}
document.getElementById('clearQueueBtn').addEventListener('click', ()=>{
  queue = []; currentIndex = -1; isPlaying = false;
  if(YTplayer) YTplayer.stopVideo();
  updateQueueUI(); saveQueueToLocal();
});

/* ---------- Player ---------- */
function playIndex(idx){
  if(queue.length === 0) return;
  currentIndex = idx;
  const item = queue[idx];
  if(YTplayer && item && item.videoId) YTplayer.loadVideoById(item.videoId);
  document.getElementById('playerTitle').textContent = item.title || 'Loading...';
  document.getElementById('playerArtist').textContent = item.channel || '‚Äî';
  document.getElementById('playerThumb').src = item.thumb || '';
  isPlaying = true; updatePlayPauseBtn(); updateQueueUI();
}
function prevTrack(){
  if(queue.length === 0) return;
  if(currentIndex > 0) playIndex(currentIndex - 1);
  else if(repeatMode === 1) playIndex(queue.length - 1);
  else playIndex(0);
}
function nextTrack(){
  if(queue.length === 0) return;
  if(repeatMode === 2) playIndex(currentIndex);
  else if(currentIndex + 1 < queue.length) playIndex(currentIndex + 1);
  else if(repeatMode === 1) playIndex(0);
  else {
    currentIndex = -1; isPlaying = false; updatePlayPauseBtn();
    document.getElementById('playerTitle').textContent = 'Not playing';
    document.getElementById('playerArtist').textContent = '‚Äî';
    document.getElementById('playerThumb').src = '';
    updateQueueUI();
  }
}

/* Controls */
function updatePlayPauseBtn(){ document.getElementById('playPauseBtn').textContent = isPlaying ? '‚è∏' : '‚ñ∂Ô∏è'; }
document.getElementById('playPauseBtn').addEventListener('click', ()=>{
  if(!YTplayer) return;
  if(currentIndex === -1 && queue.length>0){ playIndex(0); return; }
  if(isPlaying) YTplayer.pauseVideo(); else YTplayer.playVideo();
  isPlaying = !isPlaying; updatePlayPauseBtn();
});
document.getElementById('nextBtn').addEventListener('click', nextTrack);
document.getElementById('prevBtn').addEventListener('click', prevTrack);

/* Repeat */
const repeatBtn = document.getElementById('repeatBtn');
repeatBtn.addEventListener('click', ()=>{
  repeatMode = (repeatMode + 1) % 3;
  repeatBtn.textContent = repeatIcons[repeatMode];
});

/* Shuffle (Fisher-Yates) */
document.getElementById('shuffleBtn').addEventListener('click', ()=>{
  if(queue.length <= 1) return alert('Need at least 2 songs to shuffle.');
  // keep current playing track if any
  const currentId = currentIndex !== -1 ? queue[currentIndex].videoId : null;
  for(let i = queue.length - 1; i > 0; i--){
    const j = Math.floor(Math.random() * (i + 1));
    [queue[i], queue[j]] = [queue[j], queue[i]];
  }
  // restore currentIndex to new location of currentId
  if(currentId){
    const newIndex = queue.findIndex(t => t.videoId === currentId);
    if(newIndex !== -1) currentIndex = newIndex;
  }
  updateQueueUI(); saveQueueToLocal();
  alert('Queue shuffled!');
});

/* LocalStorage for queue */
function saveQueueToLocal(){ localStorage.setItem('BOIMUSIC_QUEUE', JSON.stringify(queue.map(t => t.videoId))); }
function loadQueueFromLocal(){
  const saved = JSON.parse(localStorage.getItem('BOIMUSIC_QUEUE') || '[]');
  if(saved.length){
    saved.forEach(id => queue.push({ videoId:id, title:"Loading...", channel:"", thumb:"" }));
    updateQueueUI();
    if(queue.length) playIndex(0);
    saved.forEach((vid,i)=>{
      fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${vid}&format=json`)
        .then(r=>r.json()).then(d=>{
          if(queue[i]){ queue[i].title = d.title; queue[i].channel = d.author_name; queue[i].thumb = d.thumbnail_url; updateQueueUI(); }
        }).catch(()=>{});
    });
  }
}

/* ---------- Playlists (drawer) ---------- */
function savePlaylistsToLocal(){ localStorage.setItem('BOIMUSIC_PLAYLISTS', JSON.stringify(playlists)); }

function updatePlaylistsSidebar(){
  const c = document.getElementById('playlistsList'); c.innerHTML = '';
  const names = Object.keys(playlists);
  if(!names.length){ c.innerHTML = `<div class="muted small">No playlists ‚Äî create one</div>`; return; }
  names.forEach(name=>{
    const el = document.createElement('div'); el.className = 'playlist-item'; el.textContent = name;
    el.addEventListener('click', ()=> openPlaylistDrawer(name));
    c.appendChild(el);
  });
}

/* Drawer open/close and resizing left-main to 50% when open */
const drawer = document.getElementById('playlistDrawer');
const fade = document.getElementById('fadeOverlay');
function openPlaylistDrawer(name){
  selectedPlaylist = name || selectedPlaylist;
  document.getElementById('selectedPlaylistName').textContent = selectedPlaylist || 'None';
  renderPlaylistSelectOptions();
  renderSelectedPlaylist();
  // open drawer
  drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false');
  fade.classList.add('visible');
  // shrink left-main to 50% by directly setting width of left-main area
  document.querySelector('.left-main').style.flex = '0 0 50%';
}
function closePlaylistDrawer(){
  drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true');
  fade.classList.remove('visible');
  document.querySelector('.left-main').style.flex = '1';
}
document.getElementById('closeDrawerBtn').addEventListener('click', closePlaylistDrawer);
document.getElementById('closeDrawerBtnFooter').addEventListener('click', closePlaylistDrawer);
fade.addEventListener('click', closePlaylistDrawer);

/* Render playlist select options in drawer for adding current */
function renderPlaylistSelectOptions(){
  const sel = document.getElementById('playlistAddSelect'); sel.innerHTML='';
  const names = Object.keys(playlists);
  if(names.length === 0){
    const opt = document.createElement('option'); opt.value=''; opt.textContent='(no playlists)';
    sel.appendChild(opt); sel.disabled = true;
    return;
  }
  sel.disabled = false;
  names.forEach(n=>{
    const o = document.createElement('option'); o.value = n; o.textContent = n;
    sel.appendChild(o);
  });
  // if selectedPlaylist exists, set that as selected in the select
  if(selectedPlaylist) sel.value = selectedPlaylist;
}

/* Render songs inside the drawer for the selected playlist */
function renderSelectedPlaylist(){
  const box = document.getElementById('playlistSongs'); box.innerHTML = '';
  if(!selectedPlaylist || !playlists[selectedPlaylist]){ box.innerHTML = `<div class="muted small">No playlist selected</div>`; return; }
  const songs = playlists[selectedPlaylist];
  if(!songs.length){ box.innerHTML = `<div class="muted small">Playlist is empty</div>`; return; }
  songs.forEach((track, idx)=>{
    const row = document.createElement('div'); row.className='playlist-song';
    row.innerHTML = `<div style="display:flex;align-items:center">
                       <img src="${track.thumb}" style="width:48px;height:48px;border-radius:6px;object-fit:cover">
                       <div class="song-meta"><div style="font-weight:600">${track.title}</div><div class="muted small">${track.channel}</div></div>
                     </div>`;
    const actions = document.createElement('div'); actions.className='song-actions';
    const playBtn = document.createElement('button'); playBtn.className='btn'; playBtn.textContent='Play';
    playBtn.addEventListener('click', (e)=>{ e.stopPropagation(); addToQueue(track); playIndex(queue.length - 1); });
    const delBtn = document.createElement('button'); delBtn.className='btn'; delBtn.textContent='Delete';
    delBtn.addEventListener('click', (e)=>{ e.stopPropagation();
      if(!confirm(`Remove "${track.title}" from "${selectedPlaylist}"?`)) return;
      playlists[selectedPlaylist].splice(idx,1);
      savePlaylistsToLocal(); renderSelectedPlaylist();
    });
    actions.appendChild(playBtn); actions.appendChild(delBtn);
    row.appendChild(actions);
    box.appendChild(row);
  });
}

/* Create & Delete playlists (sidebar buttons)
   Delete requires typing exact name for confirmation (as you requested earlier) */
document.getElementById('newPlaylistBtn').addEventListener('click', ()=>{
  const name = prompt('Enter a new playlist name:'); if(!name) return;
  if(playlists[name]) return alert('A playlist with that name already exists.');
  playlists[name] = []; savePlaylistsToLocal(); updatePlaylistsSidebar(); openPlaylistDrawer(name);
});
document.getElementById('deletePlaylistBtn').addEventListener('click', ()=>{
  const name = prompt('Type the exact playlist name to delete:'); if(!name) return;
  if(!playlists[name]) return alert('Playlist not found!');
  if(!confirm(`Are you sure you want to delete "${name}"? This cannot be undone.`)) return;
  delete playlists[name]; savePlaylistsToLocal();
  selectedPlaylist = (selectedPlaylist === name) ? null : selectedPlaylist;
  document.getElementById('selectedPlaylistName').textContent = selectedPlaylist || 'None';
  updatePlaylistsSidebar(); renderSelectedPlaylist();
});

/* Add currently playing song to selected playlist via dropdown in drawer */
document.getElementById('addCurrentToSelectedBtn').addEventListener('click', ()=>{
  if(currentIndex === -1) return alert('No song is currently playing.');
  const sel = document.getElementById('playlistAddSelect'); if(sel.disabled) return alert('Create a playlist first.');
  const chosen = sel.value; if(!chosen) return alert('Select a playlist.');
  const playing = queue[currentIndex];
  // push full track data
  playlists[chosen].push({
    videoId: playing.videoId, title: playing.title, channel: playing.channel, thumb: playing.thumb
  });
  savePlaylistsToLocal();
  if(selectedPlaylist === chosen) renderSelectedPlaylist();
  alert(`Added "${playing.title}" to "${chosen}"`);
});

/* Create playlist quick from drawer */
document.getElementById('createPlaylistFromDrawerBtn').addEventListener('click', ()=>{
  const name = prompt('Enter a name for the new playlist:'); if(!name) return;
  if(playlists[name]) return alert('Already exists.');
  playlists[name] = []; savePlaylistsToLocal(); updatePlaylistsSidebar(); renderPlaylistSelectOptions(); openPlaylistDrawer(name);
});

/* Play Playlist: load playlist into queue and start playback (Option A: manual Play) */
document.getElementById('playPlaylistBtn').addEventListener('click', ()=>{
  if(!selectedPlaylist) return alert('Select a playlist from the left first.');
  const list = playlists[selectedPlaylist] || [];
  if(!list.length) return alert('Playlist is empty.');
  // replace queue with playlist items
  queue = list.map(t => ({ videoId: t.videoId, title: t.title, channel: t.channel, thumb: t.thumb }));
  saveQueueToLocal(); updateQueueUI();
  playIndex(0);
  // set repeat mode to playlistRepeat if toggled
  repeatMode = playlistRepeat ? 1 : 0; repeatBtn.textContent = repeatIcons[repeatMode];
  closePlaylistDrawer();
});

/* Toggle playlistRepeat (affects repeatMode when playlist is played) */
document.getElementById('togglePlaylistRepeatBtn').addEventListener('click', ()=>{
  playlistRepeat = !playlistRepeat;
  document.getElementById('playlistRepeatState').textContent = playlistRepeat ? 'On' : 'Off';
});

/* Add to playlist button in player (opens drawer and selects playlist if possible) */
document.getElementById('addToPlaylistBtn').addEventListener('click', ()=>{
  if(currentIndex === -1) return alert('No song is currently playing.');
  // if drawer closed, open it
  if(!drawer.classList.contains('open')){
    // open and select first playlist if exists
    const names = Object.keys(playlists);
    if(names.length) openPlaylistDrawer(names[0]);
    else openPlaylistDrawer(null);
  } else {
    // focus select
  }
});

/* Render playlist options in select whenever drawer opens or playlists change */
function openPlaylistDrawer(name){
  selectedPlaylist = name || selectedPlaylist;
  document.getElementById('selectedPlaylistName').textContent = selectedPlaylist || 'None';
  renderPlaylistSelectOptions();
  renderSelectedPlaylist();
  drawer.classList.add('open'); drawer.setAttribute('aria-hidden','false');
  fade.classList.add('visible');
  document.querySelector('.left-main').style.flex = '0 0 50%';
}
function closePlaylistDrawer(){
  drawer.classList.remove('open'); drawer.setAttribute('aria-hidden','true');
  fade.classList.remove('visible');
  document.querySelector('.left-main').style.flex = '1';
}
document.getElementById('closeDrawerBtn').addEventListener('click', closePlaylistDrawer);
document.getElementById('closeDrawerBtnFooter').addEventListener('click', closePlaylistDrawer);
fade.addEventListener('click', closePlaylistDrawer);

/* ---------- Init ---------- */
window.onload = ()=>{
  loadQueueFromLocal();
  updatePlaylistsSidebar();
  renderSelectedPlaylist();
};
</script>

<!-- hidden youtube player container -->
<!-- Replace hidden yt-player div with a visible iframe -->
<div id="playerContainer" style="display:flex;align-items:center;gap:12px">
  <iframe id="yt-player" width="0" height="0"
    style="display:none"
    src=""
    frameborder="0"
    allow="autoplay; encrypted-media"
    allowfullscreen>
  </iframe>
</div>

</body>
</html>
